An error occurred while executing the following cell:
------------------
timer = Timer()
animator = Animator(xlabel="epoch", xlim=[1, num_epochs], legend=["train loss", "train acc", "test acc"])
num_batches = len(train_iter)
device = torch.device(f"cuda:{0}")

for epoch in range(num_epochs):
    # Sum of training loss, sum of training accuracy, no. of examples
    metric = Accumulator(3)
    for i, (X, y) in enumerate(train_iter):
        timer.start()
        batch = {}
        batch["image"] = jnp.reshape(jnp.float32(X), (-1, 96, 96, 1))
        batch["label"] = jnp.float32(y)
        state, metrics = train_step(state, batch)
        metric.add(metrics["loss"] * X.shape[0], metrics["numcorrect"], X.shape[0])
        timer.stop()
        train_l = metric[0] / metric[2]
        train_acc = metric[1] / metric[2]
        if (i + 1) % (num_batches // 5) == 0 or i == num_batches - 1:
            animator.add(epoch + (i + 1) / num_batches, (train_l, train_acc, None))

    test_acc = eval_model(state, test_iter)
    animator.add(epoch + 1, (None, None, test_acc))


print(f"{metric[2] * num_epochs / timer.sum():.1f} examples/sec " f"on {str(device)}")
print(f"loss {train_l:.3f}, train acc {train_acc:.3f}, " f"test acc {test_acc:.3f}")
------------------

---------------------------------------------------------------------------
ConnectionRefusedError                    Traceback (most recent call last)
~/miniconda3/envs/py37/lib/python3.7/site-packages/torch/utils/data/dataloader.py in _try_get_data(self, timeout)
   1010         try:
-> 1011             data = self._data_queue.get(timeout=timeout)
   1012             return (True, data)

~/miniconda3/envs/py37/lib/python3.7/multiprocessing/queues.py in get(self, block, timeout)
    112         # unserialize the data after having released the lock
--> 113         return _ForkingPickler.loads(res)
    114 

~/miniconda3/envs/py37/lib/python3.7/site-packages/torch/multiprocessing/reductions.py in rebuild_storage_fd(cls, df, size)
    294 def rebuild_storage_fd(cls, df, size):
--> 295     fd = df.detach()
    296     try:

~/miniconda3/envs/py37/lib/python3.7/multiprocessing/resource_sharer.py in detach(self)
     56             '''Get the fd.  This should only be called once.'''
---> 57             with _resource_sharer.get_connection(self._id) as conn:
     58                 return reduction.recv_handle(conn)

~/miniconda3/envs/py37/lib/python3.7/multiprocessing/resource_sharer.py in get_connection(ident)
     86         address, key = ident
---> 87         c = Client(address, authkey=process.current_process().authkey)
     88         c.send((key, os.getpid()))

~/miniconda3/envs/py37/lib/python3.7/multiprocessing/connection.py in Client(address, family, authkey)
    491     else:
--> 492         c = SocketClient(address)
    493 

~/miniconda3/envs/py37/lib/python3.7/multiprocessing/connection.py in SocketClient(address)
    619         s.setblocking(True)
--> 620         s.connect(address)
    621         return Connection(s.detach())

ConnectionRefusedError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

RuntimeError                              Traceback (most recent call last)
/tmp/ipykernel_2936/1115125.py in <module>
      7     # Sum of training loss, sum of training accuracy, no. of examples
      8     metric = Accumulator(3)
----> 9     for i, (X, y) in enumerate(train_iter):
     10         timer.start()
     11         batch = {}

~/miniconda3/envs/py37/lib/python3.7/site-packages/torch/utils/data/dataloader.py in __next__(self)
    528             if self._sampler_iter is None:
    529                 self._reset()
--> 530             data = self._next_data()
    531             self._num_yielded += 1
    532             if self._dataset_kind == _DatasetKind.Iterable and \

~/miniconda3/envs/py37/lib/python3.7/site-packages/torch/utils/data/dataloader.py in _next_data(self)
   1205 
   1206             assert not self._shutdown and self._tasks_outstanding > 0
-> 1207             idx, data = self._get_data()
   1208             self._tasks_outstanding -= 1
   1209             if self._dataset_kind == _DatasetKind.Iterable:

~/miniconda3/envs/py37/lib/python3.7/site-packages/torch/utils/data/dataloader.py in _get_data(self)
   1171         else:
   1172             while True:
-> 1173                 success, data = self._try_get_data()
   1174                 if success:
   1175                     return data

~/miniconda3/envs/py37/lib/python3.7/site-packages/torch/utils/data/dataloader.py in _try_get_data(self, timeout)
   1022             if len(failed_workers) > 0:
   1023                 pids_str = ', '.join(str(w.pid) for w in failed_workers)
-> 1024                 raise RuntimeError('DataLoader worker (pid(s) {}) exited unexpectedly'.format(pids_str)) from e
   1025             if isinstance(e, queue.Empty):
   1026                 return (False, None)

RuntimeError: DataLoader worker (pid(s) 3145) exited unexpectedly
RuntimeError: DataLoader worker (pid(s) 3145) exited unexpectedly
